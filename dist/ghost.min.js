/* Ghost.js 0.3.0
 * (c) 2017 Danijel Durakovic
 * MIT License */
 "use strict";var ghost={},G_NULL=void 0,G_EMPTYF=function(){},G_VIEW_DEFAULT=0,G_VIEW_SCALE_PRESERVERATIO=1,G_VIEW_SCALE_FULL=2,G_VIEW_EXPAND=3;ghost.compose=function(){if(Object.assign)return Object.assign.apply(null,arguments);for(var t=arguments[0],e=arguments.length,i=1;e>i;++i){var s=arguments[i];if(s)for(var n in s)s.hasOwnProperty(n)&&(t[n]=s[n])}return t},ghost.clamp=function(t,e,i){return e>=t?e:t>=i?i:t},ghost.getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},ghost.shuffle=function(t){for(var e=t.length;--e;){var i=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}},ghost.choose=function(t){return t instanceof Array?t[Math.floor(Math.random()*t.length)]:void 0},ghost.pointInRect=function(t,e,i,s,n,h){return t>=i&&i+n>t&&e>=s&&s+h>e},ghost.iter=function(t,e){for(var i in t){var s=t[i];!t.hasOwnProperty(i)||s instanceof Function||e(i,s)}},ghost.getFilenameExtension=function(t){return t.split(".").pop().toLowerCase()},ghost.Grid2D=function(t,e,i){this.width=t,this.height=e,this.data=new Array(t*e),this.clear=function(){for(var s=t*e,n=0;s>n;++n)this.data[n]=i},this.get=function(t,e){return this.data[e*this.width+t]},this.set=function(t,e,i){this.data[e*this.width+t]=i}},ghost.AABB=function(t,e,i,s){this.x1=t||0,this.y1=e||0,this.x2=i||0,this.y2=s||0,this.intersects=function(t){return this.x2>t.x1&&this.y2>t.y1&&this.x1<t.x2&&this.y1<t.y2}},ghost.Timer=function(t){t=t||1;var e=0;this.ticked=!1,this.run=function(i){return e+=i,e>=t?(e-=t,this.ticked=!0,!0):(this.ticked=!1,!1)},this.reset=function(){e=0,this.ticked=!1}},ghost.AssetLoader=function(t){t=t||{};var e=this,i={};this.done=t.done||G_EMPTYF,this.progress=t.progress||G_EMPTYF,this.handler={},this.handler.graphics=function(t,e){var i=new Image;i.src=t,i.addEventListener("load",function(){e(i)})},this.handler.data=function(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=i.responseText,s=JSON.parse(t);e(s)}}},this.handler.text=function(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=i.responseText,s=t;e(s)}}},this.load=function(t){function s(){n++,e.progress(n,h),n===h&&e.done()}var n=0,h=0,o=0;ghost.iter(t,function(t,e){o++,ghost.iter(e,function(){h++})}),ghost.iter(t,function(t,n){var h=e.handler[t];h instanceof Function&&ghost.iter(n,function(t,e){h(e,function(e){i[t]=e,s()})})})},this.get=function(t){return i[t]},this.acquire=function(t,e){ghost.iter(e,function(e,s){t[e]=i[s]})}},ghost.Input=function(t){function e(e,i){var s,n;switch(t.getViewMode()){case G_VIEW_SCALE_PRESERVERATIO:s=n=o.offsetWidth<a.offsetWidth?o.height/a.offsetHeight:o.width/a.offsetWidth;break;case G_VIEW_SCALE_FULL:s=o.width/a.offsetWidth,n=o.height/a.offsetHeight;break;case G_VIEW_EXPAND:case G_VIEW_DEFAULT:s=n=1}var r=o.getBoundingClientRect(),c=i===h?e.changedTouches[0].clientX:e.clientX,f=i===h?e.changedTouches[0].clientY:e.clientY;return[Math.floor((c-r.left)*s),Math.floor((f-r.top)*n)]}function i(t,i,s){if(i.preventDefault&&i.preventDefault(),s){var h=i.which||i.button;if(1!==h)return}for(var o=e(i,n),a=t.length;a--;)t[a](o);return!1}function s(t,i){if(i.preventDefault&&i.preventDefault(),!(i.touches.length>1)){for(var s=e(i,h),n=t.length;n--;)t[n](s);return!1}}var n=0,h=1,o=t.getSurface().getCanvas(),a=o.parentElement,r={press:[],move:[],release:[]};o.addEventListener("mousedown",function(t){i(r.press,t,n,!0)}),o.addEventListener("touchstart",function(t){s(r.press,t,h)}),window.addEventListener("mousemove",function(t){i(r.move,t,n,!1)}),window.addEventListener("touchmove",function(t){s(r.move,t,h)}),window.addEventListener("mouseup",function(t){i(r.release,t,n,!0)}),window.addEventListener("touchend",function(t){s(r.release,t,h)}),this.on=function(t,e){r[t].push(e)}},ghost.KeyInput=function(){function t(t,e){i.push({type:t,keycode:e})}var e=this,i=[],s=[];this.KEYDOWN=0,this.KEYUP=1,document.addEventListener("keydown",function(i){var n=i.keyCode||i.which;n!==e.keyBackspace&&n!==e.keyAlt||i.preventDefault(),s[n]||(s[n]=!0,t(e.KEYDOWN,n))}),document.addEventListener("keyup",function(i){var n=i.keyCode||i.which;n!==e.keyBackspace&&n!==e.keyAlt||i.preventDefault(),s[n]&&(delete s[n],t(e.KEYUP,n))}),window.onblur=function(){i=[],s=[]},this.clear=function(){i=[],s=[]},this.pollEvent=function(){return i.shift()},this.isAlphanumeric=function(t){return!!(t>47&&58>t||t>64&&91>t||t>96&&123>t)},this.getASCII=function(t){return String.fromCharCode(t)},this.isKeyDown=function(t){var e=s[t];return void 0!==e&&e},this.keyCancel=3,this.keyHelp=6,this.keyBackspace=8,this.keyTab=9,this.keyClear=12,this.keyReturn=13,this.keyEnter=14,this.keyShift=16,this.keyControl=17,this.keyAlt=18,this.keyPause=19,this.keyCapsLock=20,this.keyEscape=27,this.keySpace=32,this.keyPageUp=33,this.keyPageDown=34,this.keyEnd=35,this.keyHome=36,this.keyLeft=37,this.keyUp=38,this.keyRight=39,this.keyDown=40,this.keyPrintscreen=44,this.keyInsert=45,this.keyDelete=46,this.key0=48,this.key1=49,this.key2=50,this.key3=51,this.key4=52,this.key5=53,this.key6=54,this.key7=55,this.key8=56,this.key9=57,this.keySemicolon=59,this.keyEquals=61,this.keyA=65,this.keyB=66,this.keyC=67,this.keyD=68,this.keyE=69,this.keyF=70,this.keyG=71,this.keyH=72,this.keyI=73,this.keyJ=74,this.keyK=75,this.keyL=76,this.keyM=77,this.keyN=78,this.keyO=79,this.keyP=80,this.keyQ=81,this.keyR=82,this.keyS=83,this.keyT=84,this.keyU=85,this.keyV=86,this.keyW=87,this.keyX=88,this.keyY=89,this.keyZ=90,this.keyContextMenu=93,this.keyNumpad0=96,this.keyNumpad1=97,this.keyNumpad2=98,this.keyNumpad3=99,this.keyNumpad4=100,this.keyNumpad5=101,this.keyNumpad6=102,this.keyNumpad7=103,this.keyNumpad8=104,this.keyNumpad9=105,this.keyMultiply=106,this.keyAdd=107,this.keySeparator=108,this.keySubtract=109,this.keyDecimal=110,this.keyDivide=111,this.keyF1=112,this.keyF2=113,this.keyF3=114,this.keyF4=115,this.keyF5=116,this.keyF6=117,this.keyF7=118,this.keyF8=119,this.keyF9=120,this.keyF10=121,this.keyF11=122,this.keyF12=123,this.keyF13=124,this.keyF14=125,this.keyF15=126,this.keyF16=127,this.keyF17=128,this.keyF18=129,this.keyF19=130,this.keyF20=131,this.keyF21=132,this.keyF22=133,this.keyF23=134,this.keyF24=135,this.keyNumLock=144,this.keyScrollLock=145,this.keyComma=188,this.keyPeriod=190,this.keySlash=191,this.keyBackQuote=192,this.keyOpenBracket=219,this.keyBackSlash=220,this.keyCloseBracket=221,this.keyQuote=222,this.keyMeta=224},ghost.Configuration=function(t,e){var i=this;this.save=function(){localStorage.setItem(t,JSON.stringify(i))},this.load=function(){var s=localStorage.getItem(t),n=s?JSON.parse(s):e;ghost.iter(i,function(t){delete i[t]}),ghost.iter(n,function(t,e){i[t]=e})}},ghost.Render=function(t){this.setAlpha=function(e){void 0===e?e=1:0>=e?e=0:e>=1&&(e=1),t.globalAlpha=e},this.rect=function(e,i,s,n,h,o){h=void 0===h?"#fff":h,o=void 0===o?1:o,t.strokeStyle=h,t.lineWidth=o,t.strokeRect(e,i,s,n)},this.rectFill=function(e,i,s,n,h){h=void 0===h?"#fff":h,t.fillStyle=h,t.fillRect(e,i,s,n)},this.arc=function(e,i,s,n,h,o,a){o=void 0===o?"#fff":o,a=void 0===a?1:a,t.strokeStyle=o,t.lineWidth=a,t.arc(e,i,s,n,h),t.stroke()},this.circle=function(e,i,s,n,h){n=void 0===n?"#fff":n,h=void 0===h?1:h,t.strokeStyle=n,t.lineWidth=h,t.arc(e,i,s,0,2*Math.PI),t.stroke()},this.circleFill=function(e,i,s,n){n=void 0===n?"#fff":n,t.fillStyle=n,t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.fill(),t.closePath()},this.polygon=function(e,i){i=void 0===i?"#fff":i,t.fillStyle=i,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var s=e.length,n=1;s>n;n++){var h=e[n];t.lineTo(h[0],h[1])}t.closePath(),t.fill()},this.graphics=function(e,i,s,n,h){void 0===n||void 0===h?t.drawImage(e,i,s):t.drawImage(e,i,s,n,h)},this.tile=function(e,i,s,n,h,o,a){t.drawImage(e,o,a,n,h,i,s,n,h)},this.stretchTile=function(e,i,s,n,h,o,a,r,c){t.drawImage(e,o,a,n,h,i,s,r,c)},this.text=function(e,i,s,n,h,o){n=void 0===n?"#000":n,h=void 0===h?"left":h,o=void 0===o?"11px sans-serif":o,t.textBaseline="top",t.fillStyle=n,t.textAlign=h,t.font=o,t.fillText(e,i,s)},this.bmptext=function(e,i,s,n,h,o){void 0===h&&(h=0);var a,r,c,f=i.length,u=e.width,l=e.height,d=e.gfx,y=e.tilesH*h,k=0,g=e.varwidth,p=0;if(o>0){if(g){for(r=0;f>r;r++)c=i.charCodeAt(r)-32,k+=e.widths[c]+e.spacing;a=k,k=0}else a=f*u;p=1==o?Math.floor(a/2):a}for(r=0;f>r;r++){c=i.charCodeAt(r)-32;var v;if(g?(v=s+k,k+=e.widths[c]+e.spacing):v=s+r*(u+e.spacing),0!==c){var E=u*(c%e.tilesPerRow),_=l*Math.floor(c/e.tilesPerRow)+y;t.drawImage(d,E,_,u,l,v-p,n,u,l)}}}},ghost.Font=function(t){if(this.gfx=t.graphics,this.width=t.size[0],this.height=t.size[1],this.spacing=void 0===t.spacing?2:t.spacing,this.tilesPerRow=Math.floor(this.gfx.width/this.width),this.tilesH=Math.ceil(95/this.tilesPerRow)*this.height,this.varwidth=t.varwidth===!0,this.varwidth)if(t.widths instanceof Array)this.widths=t.width;else{this.widths=[];for(var e=32;126>=e;e++){var i=String.fromCharCode(e),s=t.widths[i];this.widths.push(s?s:this.width)}}},ghost.Surface=function(t){t=t||{};var e,i,s;if(t.fromCanvas)e=t.fromCanvas,this.width=e.width,this.height=e.height;else{var n=void 0===t.width?100:t.width,h=void 0===t.height?100:t.height;e=document.createElement("canvas"),this.width=e.width=n,this.height=e.hight=h}i=e.getContext("2d");var o=this.width,a=this.height;this.render=new ghost.Render(i),this.cm_clear=function(){i.clearRect(0,0,this.width,this.height)},this.cm_fill=function(){i.fillStyle=s,i.fillRect(0,0,this.width,this.height)},this.clear=G_NULL,this.setDefaultClearMethod=function(){this.clear=this.cm_clear},this.setFillClearMethod=function(t){s=void 0===t?"#000":t,this.clear=this.cm_fill},this.getCanvas=function(){return e},this.resetSize=function(){this.resize(o,a)},this.resize=function(t,i){this.width=e.width=t,this.height=e.height=i},this.setDefaultClearMethod()},ghost.State=function(t){t=t||{},this._initialized=!1,this._initState=function(t){this._initialized||(this._initialized=!0,this.surface=t,this.paint=t.render)},this.surface=G_NULL,this.paint=G_NULL,this.init=t.init||G_EMPTYF,this.in=t.in||G_EMPTYF,this.out=t.out||G_EMPTYF,this.update=t.update||G_EMPTYF,this.draw=t.draw||G_EMPTYF},ghost.Game=function(t){function e(t){for(requestAnimationFrame(e),d=t-l,l=t,y+=d;y>=o;)r.update(o*u/1e3),y-=o;c.clear(),r.draw()}function i(){requestAnimationFrame(i),c.clear(),r.draw()}function s(){clearTimeout(p),p=setTimeout(g,v)}var n,h,o,a=this,r=G_NULL,c=G_NULL,f=60,u=60,l=0,d=0,y=0,k=G_VIEW_DEFAULT,g=G_NULL,p=G_NULL,v=20,E={init:{},update:{}};E.init[G_VIEW_DEFAULT]=function(){c.resetSize(),n.style.width=c.width+"px",n.style.height=c.height+"px",n.style.top="0",n.style.left="0",n.style.right="0",n.style.bottom="0",n.style.margin="auto"},E.update[G_VIEW_DEFAULT]=G_NULL,E.init[G_VIEW_SCALE_PRESERVERATIO]=function(){c.resetSize(),E.update[G_VIEW_SCALE_PRESERVERATIO](),n.style.top="0",n.style.left="0",n.style.right="0",n.style.bottom="0",n.style.margin="auto"},E.update[G_VIEW_SCALE_PRESERVERATIO]=function(){var t,e=c.width,i=c.height,s=h.offsetWidth,o=h.offsetHeight,a=e/i,r=o*a;r>s?(a=i/e,r=s,t=s*a):t=o,n.style.width=r+"px",n.style.height=t+"px"},E.init[G_VIEW_SCALE_FULL]=function(){c.resetSize(),n.style.width="100%",n.style.height="100%",n.style.top="0",n.style.left="0"},E.update[G_VIEW_SCALE_FULL]=G_NULL,E.init[G_VIEW_EXPAND]=function(){E.update[G_VIEW_EXPAND](),n.style.top="0",n.style.left="0"},E.update[G_VIEW_EXPAND]=function(){c.resize(h.offsetWidth,h.offsetHeight)},this.setState=function(t){r&&r.out(),r=t,r._initialized||(r._initState(c),r.init()),r.in()},this.getState=function(){return r},this.getSurface=function(){return c},this.initStates=function(t){for(var e=t.length,i=0;e>i;i++){var s=t[i];s._initialized||(s._initState(c),s.init())}},this.run=function(){if(t.gameStates instanceof Array)for(var s=t.gameStates.length,n=0;s>n;n++){var h=t.gameStates[n];h._initState(c),h.init()}a.setState(t.state),t.simpleLoop?requestAnimationFrame(i):(f=t.fps||f,u=t.framerate||u,o=1e3/f,requestAnimationFrame(e))},this.setViewMode=function(t){if(g&&(g=G_NULL,window.removeEventListener("resize",s)),"string"==typeof t)switch(t.trim().toLowerCase()){case"scale-preserveratio":case"scale_preserveratio":k=G_VIEW_SCALE_PRESERVERATIO;break;case"scale-full":case"scale_full":k=G_VIEW_SCALE_FULL;break;case"expand":k=G_VIEW_EXPAND;break;default:k=G_VIEW_DEFAULT}else k=t;n.removeAttribute("style"),n.style.position="absolute",g=E.update[k],E.init[k](),g&&window.addEventListener("resize",s)},this.getViewMode=function(){return k},this.updateView=function(){g&&g()},n=document.getElementById(t.canvasId),h=n.parentElement,c=new ghost.Surface({fromCanvas:n}),t.background&&c.setFillClearMethod(t.background)};